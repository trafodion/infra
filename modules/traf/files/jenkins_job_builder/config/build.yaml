- job-template:
    name: 'core-build-check-{dist}'
    node: 'redhat_{dist}'

    builders:
      - link-logs
      - multi-git-prep:
           repos: "trafodion/core"
      - pkg-traf:
           flavor: "release"
      - check-build:
           dir: "trafodion/core"

    publishers:
      - console-log
      - git-log
      - traf-make-log

- job-group:
    name: 'traf-publish'
    dist:
      - "ahw2.2"
    jobs:
      - traf-pub-{flavor}-{dist}:
         flavor: "release"
      - traf-pub-{flavor}-{dist}:
         flavor: "debug"

- job-group:
    name: 'traf-publish-stable'
    dist:
      - "ahw2.1"
    jobs:
      - traf-pub-{flavor}-{dist}:
         flavor: "release"
      - traf-pub-{flavor}-{dist}:
         flavor: "debug"


- job-template:
    name: 'traf-pub-{flavor}-{dist}'
    node: 'redhat_{dist}'

    builders:
      - link-logs
      - clean-workspace
      - multi-git-prep:
           repos: "trafodion/core trafodion/dcs"
      - pkg-traf:
           flavor: "{flavor}"
      - pkg-dcs:
           buildDir: "trafodion/dcs"
           coreJDBC: "trafodion/core"
      - stage-traf:
           flavor: "{flavor}"

    publishers:
      - console-log
      - git-log
      - traf-make-log
      - traf-upload-to-cdn
      - traf-release-tar

- job:
    name: 'installer-build'
    node: redhat

    builders:
      - link-logs
      - multi-git-prep:
           repos: "trafodion/install"
      - pkg-install

    publishers:
      - console-log

- job:
    name: 'installer-pub'
    node: redhat

    builders:
      - link-logs
      - clean-workspace
      - multi-git-prep:
           repos: "trafodion/install"
      - pkg-install
      - stage-install

    publishers:
      - console-log
      - traf-upload-to-cdn
      - traf-release-tar

- job-template:
    name: 'dcs-build-{dist}'
    node: 'redhat_{dist}'

    builders:
      - link-logs
      - gerrit-git-prep
      - pkg-dcs:
           buildDir: "."
           coreJDBC: ""
      - check-build:
           dir: "."

    publishers:
      - console-log

# Simple file type check can run on master
# Does not need to be exclusive
- job-template:
    name: 'gate-{name}-check-for-binary'
    node: master

    builders:
      - link-logs
      - gerrit-git-prep
      - assert-no-binary-files
      - assert-no-bad-source-files

    publishers:
      - console-log

# Build procedure for trafodion
# Publish jenkins artifacts to be used by downstream test jobs
# Include build-check tests
- job-template:
    name: 'build-product-{flavor}'
    node: 'traf_bld'

    triggers:
      - zuul

    builders:
      - link-logs
      - clean-buildspace
      - multi-git-prep:
           repos: "trafodion/core trafodion/install trafodion/dcs"
      - pkg-traf:
           flavor: "{flavor}"
      - check-build:
           dir: "trafodion/core"
      - pkg-dcs:
           buildDir: "trafodion/dcs"
           coreJDBC: "trafodion/core"
      - check-build:
           dir: "trafodion/dcs"
      - pkg-install
#      no .gitignore in install
#      - check-build:
#           dir: "trafodion/install"

    publishers:
      - archive:
          artifacts: 'trafodion/install/install*.tar.gz'
      - archive:
          artifacts: 'trafodion/dcs/target/dcs*.tar.gz'
      - archive:
          artifacts: 'trafodion/core/trafodion-regress.tgz'
      - archive:
          artifacts: 'trafodion/core/trafodion_clients*.tgz'
      - archive:
          artifacts: 'trafodion/core/trafodion_server*.tgz'
      - archive:
          artifacts: 'trafodion/core/rest/target/rest*.tar.gz'
      - console-log
      - git-log
      - traf-make-log
